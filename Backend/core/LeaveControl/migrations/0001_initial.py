# Generated by Django 5.2.8 on 2025-11-29 14:46

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('PayrollSystem', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='EmployeeLeaveBalance',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('year', models.PositiveIntegerField()),
                ('opening_balance', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('accrued', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('assigned', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('used', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('pending', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('cancelled', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('carried_forward', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('encashed', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('lapsed', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('carry_forward_from_previous', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('carry_forward_to_next', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('carry_forward_expiry_date', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_accrued_at', models.DateTimeField(blank=True, null=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_balances', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='user_leave_balances', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-year', 'leave_type__name'],
            },
        ),
        migrations.CreateModel(
            name='LeaveApplication',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('from_date', models.DateField()),
                ('to_date', models.DateField()),
                ('from_time', models.TimeField(blank=True, help_text='For half day/short leave', null=True)),
                ('to_time', models.TimeField(blank=True, help_text='For half day/short leave', null=True)),
                ('duration_type', models.CharField(choices=[('full_day', 'Full Day'), ('half_day', 'Half Day'), ('short_leave', 'Short Leave'), ('multiple_days', 'Multiple Days')], default='full_day', max_length=20)),
                ('total_days', models.DecimalField(decimal_places=2, max_digits=5)),
                ('reason', models.TextField()),
                ('contact_number', models.CharField(blank=True, max_length=20, null=True)),
                ('alternate_contact', models.CharField(blank=True, max_length=20, null=True)),
                ('medical_certificate', models.FileField(blank=True, null=True, upload_to='leave_documents/')),
                ('supporting_documents', models.JSONField(blank=True, default=list, help_text='List of document URLs')),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled'), ('partially_approved', 'Partially Approved')], default='draft', max_length=20)),
                ('applied_at', models.DateTimeField(auto_now_add=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('comments', models.TextField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True, null=True)),
                ('approval_workflow', models.JSONField(default=list, help_text="[{'approver_id': '...', 'status': 'pending', 'approved_at': '...'}]")),
                ('balance_before', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('balance_after', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('cancelled_at', models.DateTimeField(blank=True, null=True)),
                ('cancellation_reason', models.TextField(blank=True, null=True)),
                ('is_modified', models.BooleanField(default=False)),
                ('modified_from', models.JSONField(blank=True, help_text='Previous leave details', null=True)),
                ('modified_at', models.DateTimeField(blank=True, null=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_applications', to=settings.AUTH_USER_MODEL)),
                ('cancelled_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='cancelled_leaves', to=settings.AUTH_USER_MODEL)),
                ('current_approver', models.ForeignKey(blank=True, limit_choices_to={'role__in': ['admin', 'user']}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pending_leave_approvals', to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(limit_choices_to={'role': 'organization'}, on_delete=django.db.models.deletion.CASCADE, related_name='org_leave_applications', to=settings.AUTH_USER_MODEL)),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_leaves', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='user_leave_applications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-applied_at'],
            },
        ),
        migrations.CreateModel(
            name='CompensatoryOff',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('work_date', models.DateField(help_text='Date when extra work was done')),
                ('work_start_time', models.TimeField()),
                ('work_end_time', models.TimeField()),
                ('total_hours', models.DecimalField(decimal_places=2, max_digits=5)),
                ('comp_off_days', models.DecimalField(decimal_places=2, default=1.0, max_digits=5)),
                ('reason', models.TextField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('used', 'Used'), ('expired', 'Expired')], default='pending', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('comments', models.TextField(blank=True, null=True)),
                ('used_at', models.DateTimeField(blank=True, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('is_expired', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_comp_offs', to=settings.AUTH_USER_MODEL)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_comp_offs', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='user_comp_offs', to=settings.AUTH_USER_MODEL)),
                ('used_in_leave', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='comp_off_used', to='LeaveControl.leaveapplication')),
            ],
            options={
                'ordering': ['-work_date'],
            },
        ),
        migrations.CreateModel(
            name='LeavePolicy',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('scope', models.CharField(choices=[('organization', 'Organization Wide'), ('department', 'Department'), ('designation', 'Designation'), ('employee', 'Individual Employee')], default='organization', max_length=20)),
                ('scope_value', models.CharField(blank=True, help_text='Department/Designation/Employee ID', max_length=200, null=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True, null=True)),
                ('effective_from', models.DateField()),
                ('effective_to', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('leave_allocations', models.JSONField(default=dict, help_text="{'CL': 12, 'SL': 12, 'EL': 15, ...}")),
                ('probation_period_days', models.IntegerField(default=90, help_text='Days before leave can be availed')),
                ('max_leaves_per_month', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('weekend_count_in_leave', models.BooleanField(default=False)),
                ('holiday_count_in_leave', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin', models.ForeignKey(blank=True, limit_choices_to={'role': 'admin'}, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_policies', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_leave_policies', to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(limit_choices_to={'role': 'organization'}, on_delete=django.db.models.deletion.CASCADE, related_name='leave_policies', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-effective_from', 'name'],
            },
        ),
        migrations.CreateModel(
            name='LeaveType',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('code', models.CharField(max_length=20)),
                ('category', models.CharField(choices=[('casual', 'Casual Leave (CL)'), ('sick', 'Sick Leave (SL)'), ('earned', 'Earned Leave (EL)'), ('privilege', 'Privilege Leave (PL)'), ('maternity', 'Maternity Leave (ML)'), ('paternity', 'Paternity Leave'), ('compensatory', 'Compensatory Off (Comp Off)'), ('lwp', 'Leave Without Pay (LWP)'), ('sabbatical', 'Sabbatical Leave'), ('bereavement', 'Bereavement Leave'), ('marriage', 'Marriage Leave'), ('other', 'Other')], default='other', max_length=20)),
                ('default_count', models.DecimalField(decimal_places=2, default=0.0, max_digits=5)),
                ('max_count', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('is_paid', models.BooleanField(default=True)),
                ('is_active', models.BooleanField(default=True)),
                ('accrual_enabled', models.BooleanField(default=False)),
                ('accrual_frequency', models.CharField(choices=[('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('yearly', 'Yearly')], default='monthly', max_length=20)),
                ('accrual_rate', models.DecimalField(decimal_places=2, default=0.0, help_text='Days per accrual period', max_digits=5)),
                ('carry_forward_enabled', models.BooleanField(default=False)),
                ('max_carry_forward', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('carry_forward_validity_months', models.IntegerField(default=12, help_text='Months after which carry forward expires')),
                ('encashment_enabled', models.BooleanField(default=False)),
                ('max_encashment_days', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('encashment_percentage', models.DecimalField(decimal_places=2, default=100.0, help_text='% of salary for encashment', max_digits=5)),
                ('requires_approval', models.BooleanField(default=True)),
                ('min_advance_days', models.IntegerField(default=0, help_text='Minimum days in advance for application')),
                ('max_consecutive_days', models.IntegerField(blank=True, help_text='Maximum consecutive days allowed', null=True)),
                ('half_day_allowed', models.BooleanField(default=False)),
                ('short_leave_allowed', models.BooleanField(default=False)),
                ('short_leave_duration_hours', models.DecimalField(decimal_places=2, default=2.0, max_digits=4)),
                ('requires_medical_certificate', models.BooleanField(default=False)),
                ('requires_document', models.BooleanField(default=False)),
                ('description', models.TextField(blank=True, null=True)),
                ('color_code', models.CharField(default='#3498db', help_text='Hex color for calendar display', max_length=7)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_types', to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(limit_choices_to={'role': 'organization'}, on_delete=django.db.models.deletion.CASCADE, related_name='organization_leave_policies', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['name'],
                'unique_together': {('admin', 'code', 'is_active')},
            },
        ),
        migrations.CreateModel(
            name='LeaveEncashment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('encashment_date', models.DateField()),
                ('days_to_encash', models.DecimalField(decimal_places=2, max_digits=5)),
                ('encashment_percentage', models.DecimalField(decimal_places=2, default=100.0, max_digits=5)),
                ('daily_rate', models.DecimalField(decimal_places=2, max_digits=12)),
                ('encashment_amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('processed', 'Processed')], default='pending', max_length=20)),
                ('reason', models.TextField()),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('comments', models.TextField(blank=True, null=True)),
                ('payroll_month', models.IntegerField(blank=True, null=True)),
                ('payroll_year', models.IntegerField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_encashments', to=settings.AUTH_USER_MODEL)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_encashments', to=settings.AUTH_USER_MODEL)),
                ('leave_balance', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='LeaveControl.employeeleavebalance')),
                ('payroll_record', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='leave_encashments', to='PayrollSystem.payrollrecord')),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='user_leave_encashments', to=settings.AUTH_USER_MODEL)),
                ('leave_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='LeaveControl.leavetype')),
            ],
            options={
                'ordering': ['-encashment_date'],
            },
        ),
        migrations.CreateModel(
            name='LeaveBalanceAdjustment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('adjustment_date', models.DateField()),
                ('adjustment_type', models.CharField(choices=[('credit', 'Credit'), ('debit', 'Debit'), ('correction', 'Correction')], max_length=20)),
                ('days', models.DecimalField(decimal_places=2, max_digits=5)),
                ('balance_before', models.DecimalField(decimal_places=2, max_digits=5)),
                ('balance_after', models.DecimalField(decimal_places=2, max_digits=5)),
                ('reason', models.TextField()),
                ('reference_number', models.CharField(blank=True, max_length=100, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('admin', models.ForeignKey(limit_choices_to={'role': 'admin'}, on_delete=django.db.models.deletion.CASCADE, related_name='admin_leave_adjustments', to=settings.AUTH_USER_MODEL)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_adjustments', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_adjustments', to=settings.AUTH_USER_MODEL)),
                ('leave_balance', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='LeaveControl.employeeleavebalance')),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='user_leave_adjustments', to=settings.AUTH_USER_MODEL)),
                ('leave_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='LeaveControl.leavetype')),
            ],
            options={
                'ordering': ['-adjustment_date'],
            },
        ),
        migrations.CreateModel(
            name='LeaveApprovalDelegation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('effective_from', models.DateField()),
                ('effective_to', models.DateField()),
                ('is_active', models.BooleanField(default=True)),
                ('max_approval_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum days that can be approved', max_digits=5, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('delegate', models.ForeignKey(limit_choices_to={'role__in': ['admin', 'user']}, on_delete=django.db.models.deletion.CASCADE, related_name='received_delegations', to=settings.AUTH_USER_MODEL)),
                ('delegator', models.ForeignKey(limit_choices_to={'role__in': ['admin', 'user']}, on_delete=django.db.models.deletion.CASCADE, related_name='delegated_approvals', to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(limit_choices_to={'role': 'organization'}, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('leave_types', models.ManyToManyField(blank=True, help_text='Leave types for delegation (empty = all)', to='LeaveControl.leavetype')),
            ],
            options={
                'ordering': ['-effective_from'],
            },
        ),
        migrations.AddField(
            model_name='leaveapplication',
            name='leave_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='applications', to='LeaveControl.leavetype'),
        ),
        migrations.CreateModel(
            name='LeaveAccrualLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('accrual_date', models.DateField()),
                ('accrual_period_start', models.DateField()),
                ('accrual_period_end', models.DateField()),
                ('days_accrued', models.DecimalField(decimal_places=2, max_digits=5)),
                ('balance_before', models.DecimalField(decimal_places=2, max_digits=5)),
                ('balance_after', models.DecimalField(decimal_places=2, max_digits=5)),
                ('is_processed', models.BooleanField(default=False)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('leave_balance', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='LeaveControl.employeeleavebalance')),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, related_name='leave_accrual_logs', to=settings.AUTH_USER_MODEL)),
                ('leave_type', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='LeaveControl.leavetype')),
            ],
            options={
                'ordering': ['-accrual_date'],
            },
        ),
        migrations.AddField(
            model_name='employeeleavebalance',
            name='leave_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employee_balances', to='LeaveControl.leavetype'),
        ),
        migrations.CreateModel(
            name='LeaveCalendarEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('event_date', models.DateField()),
                ('is_full_day', models.BooleanField(default=True)),
                ('start_time', models.TimeField(blank=True, null=True)),
                ('end_time', models.TimeField(blank=True, null=True)),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True, null=True)),
                ('color', models.CharField(default='#3498db', max_length=7)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('leave_application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='calendar_event', to='LeaveControl.leaveapplication')),
                ('user', models.ForeignKey(limit_choices_to={'role': 'user'}, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['event_date'],
                'indexes': [models.Index(fields=['user', 'event_date'], name='LeaveContro_user_id_5c58e0_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='leaveapplication',
            index=models.Index(fields=['user', 'status'], name='LeaveContro_user_id_5a6aad_idx'),
        ),
        migrations.AddIndex(
            model_name='leaveapplication',
            index=models.Index(fields=['from_date', 'to_date'], name='LeaveContro_from_da_4c1a97_idx'),
        ),
        migrations.AddIndex(
            model_name='leaveapplication',
            index=models.Index(fields=['leave_type', 'status'], name='LeaveContro_leave_t_1b0671_idx'),
        ),
        migrations.AddIndex(
            model_name='leaveaccruallog',
            index=models.Index(fields=['user', 'accrual_date'], name='LeaveContro_user_id_5bc353_idx'),
        ),
        migrations.AddIndex(
            model_name='employeeleavebalance',
            index=models.Index(fields=['user', 'year'], name='LeaveContro_user_id_ed5a14_idx'),
        ),
        migrations.AddIndex(
            model_name='employeeleavebalance',
            index=models.Index(fields=['leave_type', 'year'], name='LeaveContro_leave_t_0675af_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='employeeleavebalance',
            unique_together={('user', 'leave_type', 'year', 'is_active')},
        ),
    ]
